---
config:
  theme: mc
  layout: dagre
---
flowchart LR
 subgraph Client["Ambiente client"]
        BrowserExt["Estensione browser"]
        Dashboard["Dashboard web"]
        ZshPlugin["Plugin zsh"]
        Disk["Disco Locale"]
  end
 subgraph NodeLayer["Strato applicativo Node.js"]
        NodeAPI["node-api"]
        NodeWorker["node-worker"]
  end
 subgraph Engine["Engine / Tool"]
        Nginx["Nginx reverse proxy"]
        NodeLayer
        Redis["Redis (code job)"]
        GraphDB["GraphDB (ontologia OntoWeb-PT)"]
        GraphDBInit["graphdb-init (bootstrap)"]
  end
    ZshPlugin -- Genera PCAP e TLS keys --> Disk
    BrowserExt -- HTTP e WebSocket --> Nginx
    Dashboard -- HTTP e WebSocket --> Nginx
    Dashboard -- Seleziona PCAP e TLS keys --> Disk
    Nginx -- Proxy HTTP e WS --> NodeAPI
    NodeAPI -- Enqueue job asincroni --> Redis
    NodeWorker -- Consume job --> Redis
    NodeAPI -- SPARQL read --> GraphDB
    NodeWorker -- SPARQL write findings --> GraphDB
    GraphDBInit -- Crea repo e importa ontologia --> GraphDB
    NodeWorker -- Log e stato job --> NodeAPI
    NodeAPI -- End connection --> NodeWorker
    NodeLayer --> Engine