sequenceDiagram
    actor U as Utente
    participant P as Pagina SendPCAP
    participant H as HealthService
    participant A as Alert globale

    U->>P: Click su pulsante "Continue"
    P->>P: Verifica prerequisiti locali dello step (file presenti, richieste selezionate, ecc.)

    alt Prerequisiti locali NON soddisfatti
        P-->>U: Mantiene lo step corrente Pulsante "Continue" disabilitato
    else Prerequisiti locali soddisfatti
        P->>P: checkingTool = true
        P-->>U: Aggiorna etichetta pulsante a "Checking tool..."
        P->>H: getHealth()
        H-->>P: health o errore
        P->>P: toolStatus = deriveToolStatus(health)

        alt toolStatus diverso da "tool_off"
            P->>P: checkingTool = false
            P-->>U: Ripristina etichetta pulsante "Continue"
            P->>P: Esegue logica dello step (avanzamento, estrazione o invio)
        else toolStatus "tool_off" o errore
            P->>P: checkingTool = false
            P->>P: errorMessage = "The analysis tool is currently OFF. Please enable it before continuing."
            P-->>A: Render Alert errore
            P->>P: Scroll contenuto verso l'alto
            P-->>U: activeStep invariato Pulsante "Continue" riabilitato
        end
    end
