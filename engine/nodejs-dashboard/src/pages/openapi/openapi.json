{
  "openapi": "3.0.1",
  "info": {
    "title": "OntoWebPT - Backend API",
    "version": "1.0.0",
    "description": "API for ingesting, listing and retrieving HTTP request data, analyzer findings, techstack findings, SPARQL access and PCAP processing."
  },
  "paths": {
    "/http-requests/ingest-http": {
      "post": {
        "tags": ["HTTP Requests"],
        "summary": "Ingest one or more HTTP requests",
        "description": "Enqueues an ingestion job. Accepts either a single HTTP request object, an array of objects, or an object containing an `items` array and an optional `activateResolver` flag.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  {
                    "$ref": "#/components/schemas/HttpRequest"
                  },
                  {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/HttpRequest"
                    },
                    "minItems": 1
                  },
                  {
                    "type": "object",
                    "properties": {
                      "items": {
                        "type": "array",
                        "items": {
                          "$ref": "#/components/schemas/HttpRequest"
                        },
                        "minItems": 1
                      },
                      "activateResolver": {
                        "type": "boolean",
                        "default": false,
                        "description": "If true, also enqueue the HTTP resolver job."
                      }
                    },
                    "required": ["items"],
                    "additionalProperties": false
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Ingestion job accepted (and optional HTTP resolver job).",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HttpIngestResponse"
                }
              }
            }
          },
          "500": {
            "description": "Enqueue failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/http-requests/results/{jobId}": {
      "get": {
        "tags": ["HTTP Requests"],
        "summary": "Get status or result of an HTTP ingest job",
        "description": "Returns job status and result data for an HTTP ingest or resolver job.",
        "parameters": [
          {
            "name": "jobId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Job status detail",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JobStatus"
                }
              }
            }
          },
          "404": {
            "description": "Job not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "jobId": { "type": "string" }
                  },
                  "required": ["error", "jobId"]
                }
              }
            }
          },
          "500": {
            "description": "Failed to retrieve results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/http-requests/list": {
      "get": {
        "tags": ["HTTP Requests"],
        "summary": "List HTTP requests (paginated)",
        "description": "Returns HTTP requests with optional pagination and filtering.\n\nSupported filters (query parameters):\n- method: HTTP method (e.g. GET, POST).\n- scheme: URL scheme (e.g. http, https).\n- authority: Hostname or host:port (e.g. example.com, example.com:443).\n- path: Request path (starting with \"/\"), e.g. \"/login\".\n- headerName: Request header name (lowercased), e.g. \"content-type\".\n- headerValue: Request header value (substring match).\n- text: Free-text search across URL, headers and other indexed fields.",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "schema": { "type": "integer", "minimum": 0, "maximum": 1000 },
            "required": false
          },
          {
            "name": "offset",
            "in": "query",
            "schema": { "type": "integer", "minimum": 0, "maximum": 1000000 },
            "required": false
          },
          { "name": "method", "in": "query", "schema": { "type": "string" }, "required": false },
          { "name": "scheme", "in": "query", "schema": { "type": "string" }, "required": false },
          { "name": "authority", "in": "query", "schema": { "type": "string" }, "required": false },
          { "name": "path", "in": "query", "schema": { "type": "string" }, "required": false },
          {
            "name": "headerName",
            "in": "query",
            "schema": { "type": "string" },
            "required": false
          },
          {
            "name": "headerValue",
            "in": "query",
            "schema": { "type": "string" },
            "required": false
          },
          { "name": "text", "in": "query", "schema": { "type": "string" }, "required": false }
        ],
        "responses": {
          "200": {
            "description": "HTTP requests list with pagination metadata.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HttpRequestListResponse"
                }
              }
            }
          },
          "502": {
            "description": "GraphDB query failed",
            "content": {
              "application/json": {
                "schema": { "type": "object" }
              }
            }
          }
        }
      }
    },

    "/http-requests/{id}": {
      "get": {
        "tags": ["HTTP Requests"],
        "summary": "Get single HTTP request by ID",
        "description": "Returns the details of a single HTTP request.",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "maxLength": 256 }
          }
        ],
        "responses": {
          "200": {
            "description": "Request details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HttpRequest"
                }
              }
            }
          },
          "404": {
            "description": "Request not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "502": {
            "description": "GraphDB query failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/http-requests/finding/list": {
      "get": {
        "tags": ["HTTP Requests"],
        "summary": "List HTTP findings",
        "description": "Paginated list of HttpScan findings detected by HttpResolverInstance. Returns finding IDs only (no details).",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "schema": { "type": "integer", "minimum": 0, "maximum": 1000, "default": 100 },
            "required": false
          },
          {
            "name": "offset",
            "in": "query",
            "schema": { "type": "integer", "minimum": 0, "maximum": 1000000, "default": 0 },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "Findings list",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HttpFindingListResponse"
                }
              }
            }
          },
          "502": {
            "description": "GraphDB error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/http-requests/finding/{id}": {
      "get": {
        "tags": ["HTTP Requests"],
        "summary": "HTTP finding detail",
        "description": "Get detailed information about an HTTP finding, including related HTTP entities.",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "maxLength": 256 }
          }
        ],
        "responses": {
          "200": {
            "description": "Finding detail",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HttpFindingDetail"
                }
              }
            }
          },
          "404": {
            "description": "Finding not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "502": {
            "description": "GraphDB error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/analyzer/analyze": {
      "post": {
        "tags": ["Analyzer"],
        "summary": "Analyze HTML, scripts, forms and iframes",
        "description": "Enqueues a static analysis job using HTML, scripts, forms and iframe data for a given URL.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AnalyzerAnalyzeRequest"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Analyzer job accepted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accepted": { "type": "boolean" },
                    "jobId": { "type": "string" },
                    "url": { "type": "string" },
                    "scripts": { "type": "integer", "description": "Number of scripts analyzed" },
                    "forms": { "type": "integer", "description": "Number of forms analyzed" },
                    "iframes": { "type": "integer", "description": "Number of iframes analyzed" },
                    "includeSnippets": { "type": "boolean" }
                  },
                  "required": [
                    "accepted",
                    "jobId",
                    "url",
                    "scripts",
                    "forms",
                    "iframes",
                    "includeSnippets"
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Enqueue failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/analyzer/results/{jobId}": {
      "get": {
        "tags": ["Analyzer"],
        "summary": "Get status or result of analyzer job",
        "description": "Returns job execution status and result payload for a static analysis job.",
        "parameters": [
          {
            "name": "jobId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Job status detail",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JobStatus"
                }
              }
            }
          },
          "404": {
            "description": "Job not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "jobId": { "type": "string" }
                  },
                  "required": ["error", "jobId"]
                }
              }
            }
          },
          "500": {
            "description": "Failed to retrieve results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/analyzer/finding/list": {
      "get": {
        "tags": ["Analyzer"],
        "summary": "List analyzer findings (paginated)",
        "description": "Paginated list of AnalyzerScan findings detected by AnalyzerResolverInstance. Returns finding IDs only (no details).",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 0, "maximum": 1000, "default": 100 }
          },
          {
            "name": "offset",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 0, "maximum": 1000000, "default": 0 }
          }
        ],
        "responses": {
          "200": {
            "description": "Analyzer findings list",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AnalyzerFindingListResponse"
                }
              }
            }
          },
          "502": {
            "description": "GraphDB query failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/analyzer/finding/{id}": {
      "get": {
        "tags": ["Analyzer"],
        "summary": "Get analyzer finding detail",
        "description": "Returns full details for a specific analyzer finding, including HTML context and nested tags.",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Finding detail",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AnalyzerFindingDetail"
                }
              }
            }
          },
          "404": {
            "description": "Finding not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "502": {
            "description": "GraphDB query failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/techstack/analyze": {
      "post": {
        "tags": ["Techstack"],
        "summary": "Analyze detected technologies, WAF, headers and cookies",
        "description": "Enqueues a job to analyze the technology stack based on headers, cookies, WAF hints and client-detected technologies.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TechstackAnalyzeRequest"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Techstack analysis job accepted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accepted": { "type": "boolean" },
                    "jobId": { "type": "string" },
                    "technologies": {
                      "type": "integer",
                      "description": "Number of technologies in the payload"
                    },
                    "waf": {
                      "type": "integer",
                      "description": "Number of WAF entries in the payload"
                    },
                    "secureHeaders": {
                      "type": "integer",
                      "description": "Number of secureHeaders entries in the payload"
                    },
                    "cookies": {
                      "type": "integer",
                      "description": "Number of cookies in the payload"
                    }
                  },
                  "required": [
                    "accepted",
                    "jobId",
                    "technologies",
                    "waf",
                    "secureHeaders",
                    "cookies"
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Enqueue failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/techstack/results/{jobId}": {
      "get": {
        "tags": ["Techstack"],
        "summary": "Get status or result of a techstack analysis job",
        "description": "Returns job execution status and analyzed technology stack details.",
        "parameters": [
          {
            "name": "jobId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Job status detail",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JobStatus"
                }
              }
            }
          },
          "404": {
            "description": "Job not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "jobId": { "type": "string" }
                  },
                  "required": ["error", "jobId"]
                }
              }
            }
          },
          "500": {
            "description": "Internal error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/techstack/finding/list": {
      "get": {
        "tags": ["Techstack"],
        "summary": "List techstack findings (paginated)",
        "description": "Returns findings detected by the Techstack resolver, without detailed evidence.",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 0, "maximum": 1000, "default": 100 }
          },
          {
            "name": "offset",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 0, "maximum": 1000000, "default": 0 }
          }
        ],
        "responses": {
          "200": {
            "description": "Findings list",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TechstackFindingListResponse"
                }
              }
            }
          },
          "502": {
            "description": "GraphDB query failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/techstack/finding/{id}": {
      "get": {
        "tags": ["Techstack"],
        "summary": "Get techstack finding details",
        "description": "Returns complete detail for a single Techstack finding, including software evidence, header evidence and cookie evidence.",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Finding detail",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TechstackFindingDetail"
                }
              }
            }
          },
          "404": {
            "description": "Finding not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "502": {
            "description": "GraphDB query failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/sparql/query": {
      "post": {
        "tags": ["SPARQL"],
        "summary": "Execute a SPARQL SELECT/ASK query",
        "description": "Validates and executes a SPARQL SELECT or ASK query synchronously. UPDATE is not allowed in this endpoint.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SparqlQueryRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "SPARQL query executed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SparqlQueryResponse"
                }
              }
            }
          },
          "502": {
            "description": "GraphDB query failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/sparql/update": {
      "post": {
        "tags": ["SPARQL"],
        "summary": "Enqueue a SPARQL UPDATE job",
        "description": "Accepts a SPARQL UPDATE query and enqueues it for asynchronous execution.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SparqlUpdateRequest"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Update job accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnqueueResponse"
                }
              }
            }
          },
          "500": {
            "description": "Failed to enqueue SPARQL update job",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },

    "/health": {
      "get": {
        "tags": ["Health"],
        "summary": "Health status of the API server and dependencies",
        "description": "Returns overall readiness/health of the API, including server, GraphDB and Redis status.",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Service is healthy and all dependencies are UP",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "description": "Health report for server and dependencies.",
                  "additionalProperties": true
                }
              }
            }
          },
          "503": {
            "description": "One or more dependencies are DOWN (server, Redis, GraphDB)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "description": "Error details for failing dependency.",
                  "additionalProperties": true
                }
              }
            }
          }
        }
      }
    },

    "/pcap/pcap-http-requests": {
      "post": {
        "tags": ["PCAP"],
        "summary": "Extract HTTP requests from a PCAP and TLS keylog file",
        "description": "Accepts a PCAP/PCAPNG capture file and a TLS keylog file (e.g. sslkeys.log), runs an offline decoder (tshark + pcap_to_http_json.py) and returns the extracted HTTP requests. The output is already compatible with the /http-requests/ingest-http schema.",
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "pcap": {
                    "type": "string",
                    "format": "binary",
                    "description": "PCAP or PCAPNG file containing captured HTTP/HTTPS traffic"
                  },
                  "sslkeys": {
                    "type": "string",
                    "format": "binary",
                    "description": "TLS keylog file (e.g. sslkeys.log) used to decrypt HTTPS traffic"
                  }
                },
                "required": ["pcap", "sslkeys"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "HTTP requests successfully extracted from the PCAP",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "description": "HttpRequest object compatible with /http-requests/ingest-http schema"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Missing or invalid file fields (pcap and/or sslkeys)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" }
                  }
                }
              }
            }
          },
          "500": {
            "description": "PCAP processing failed (tshark/python error or JSON parsing error)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string" },
                    "detail": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": { "type": "string" },
          "detail": { "type": "string" }
        },
        "required": ["error"],
        "additionalProperties": true
      },
      "HttpHeader": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Header name, usually lower-cased"
          },
          "value": {
            "type": "string",
            "description": "Header value"
          }
        },
        "required": ["name", "value"]
      },
      "HttpQueryParam": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "value": { "type": "string" }
        },
        "required": ["name"]
      },
      "HttpUri": {
        "type": "object",
        "properties": {
          "full": {
            "type": "string",
            "description": "Full request URL"
          },
          "scheme": { "type": "string" },
          "authority": { "type": "string" },
          "path": { "type": "string" },
          "fragment": { "type": "string" },
          "queryXml": { "type": "string" },
          "queryRaw": {
            "type": "string",
            "description": "Raw query string, without leading '?'"
          },
          "params": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/HttpQueryParam" }
          }
        }
      },
      "HttpConnection": {
        "type": "object",
        "properties": {
          "authority": {
            "type": "string",
            "description": "Remote endpoint (host:port)"
          }
        },
        "required": ["authority"]
      },
      "HttpResponse": {
        "type": "object",
        "description": "HTTP response part; supports both GraphDB (status/reason/bodyBase64/headers) and PCAP (statusCode/reasonPhrase/body/responseHeaders) representations.",
        "properties": {
          "httpVersion": { "type": "string" },
          "status": {
            "type": "integer",
            "description": "HTTP status code (GraphDB representation)"
          },
          "statusCode": {
            "type": "integer",
            "description": "HTTP status code (PCAP representation)"
          },
          "reason": {
            "type": "string",
            "description": "Reason phrase (GraphDB representation)"
          },
          "reasonPhrase": {
            "type": "string",
            "description": "Reason phrase (PCAP representation)"
          },
          "bodyBase64": {
            "type": "string",
            "description": "Base64-encoded HTTP body (GraphDB representation)"
          },
          "body": {
            "type": "string",
            "description": "Base64-encoded HTTP body (PCAP representation)"
          },
          "headers": {
            "type": "array",
            "description": "Response headers (GraphDB representation)",
            "items": { "$ref": "#/components/schemas/HttpHeader" }
          },
          "responseHeaders": {
            "type": "array",
            "description": "Response headers (PCAP representation)",
            "items": { "$ref": "#/components/schemas/HttpHeader" }
          }
        }
      },
      "HttpRequest": {
        "type": "object",
        "description": "Normalized HTTP request as used by ingest, GraphDB list endpoints and PCAP extraction.",
        "properties": {
          "graph": {
            "type": "string",
            "description": "Named graph IRI where the request is stored"
          },
          "id": {
            "type": "string",
            "description": "Request identifier"
          },
          "method": {
            "type": "string",
            "description": "HTTP method, usually upper-cased"
          },
          "httpVersion": { "type": "string" },
          "bodyBase64": {
            "type": "string",
            "description": "Base64-encoded HTTP request body"
          },
          "uri": {
            "$ref": "#/components/schemas/HttpUri"
          },
          "requestHeaders": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/HttpHeader" }
          },
          "response": {
            "$ref": "#/components/schemas/HttpResponse"
          },
          "connection": {
            "$ref": "#/components/schemas/HttpConnection"
          }
        },
        "required": ["id", "method", "uri"]
      },
      "HttpIngestJob": {
        "type": "object",
        "properties": {
          "accepted": { "type": "boolean" },
          "jobId": { "type": "string" },
          "count": {
            "type": "integer",
            "description": "Number of HTTP requests in the job"
          }
        },
        "required": ["accepted", "jobId", "count"]
      },
      "HttpIngestResponse": {
        "type": "object",
        "properties": {
          "resRequest": {
            "$ref": "#/components/schemas/HttpIngestJob"
          },
          "resResolver": {
            "$ref": "#/components/schemas/HttpIngestJob"
          }
        },
        "required": ["resRequest"]
      },
      "JobStatus": {
        "type": "object",
        "properties": {
          "jobId": { "type": "string" },
          "state": {
            "type": "string",
            "description": "Queue job state (e.g. waiting, active, completed, failed)"
          },
          "result": {
            "type": "object",
            "nullable": true,
            "description": "Job result payload, if available; structure depends on job type.",
            "additionalProperties": true
          },
          "createdAt": {
            "type": "integer",
            "format": "int64",
            "description": "Job creation timestamp (ms since epoch)"
          },
          "finishedAt": {
            "type": "integer",
            "format": "int64",
            "nullable": true,
            "description": "Job completion timestamp (ms since epoch), or null if not finished"
          }
        },
        "required": ["jobId", "state", "createdAt"]
      },
      "PageMetadata": {
        "type": "object",
        "properties": {
          "limit": { "type": "integer" },
          "offset": { "type": "integer" },
          "total": { "type": "integer" },
          "hasNext": { "type": "boolean" },
          "hasPrev": { "type": "boolean" },
          "nextOffset": {
            "type": "integer",
            "nullable": true
          },
          "prevOffset": {
            "type": "integer",
            "nullable": true
          }
        },
        "required": ["limit", "offset", "total", "hasNext", "hasPrev"]
      },
      "HttpRequestListResponse": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/HttpRequest" }
          },
          "page": { "$ref": "#/components/schemas/PageMetadata" }
        },
        "required": ["items", "page"]
      },
      "HttpFindingDetail": {
        "type": "object",
        "description": "Detailed HttpScan finding.",
        "properties": {
          "id": { "type": "string" },
          "resolver": { "type": "string" },
          "vulnerabilityType": { "type": "string" },
          "severity": { "type": "string" },
          "findingCategory": { "type": "string" },
          "owaspCategory": { "type": "string" },
          "ruleId": { "type": "string" },
          "description": { "type": "string" },
          "remediation": { "type": "string" },
          "http": {
            "type": "object",
            "properties": {
              "method": { "type": "string" },
              "url": { "type": "string" },
              "status": { "type": "integer" }
            }
          },
          "relatedHttp": {
            "type": "array",
            "description": "List of related HTTP request IRIs.",
            "items": { "type": "string" }
          }
        },
        "required": ["id"]
      },
      "HttpFindingListResponse": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "string",
              "description": "Finding ID (IRI as string)"
            }
          },
          "page": { "$ref": "#/components/schemas/PageMetadata" }
        },
        "required": ["items", "page"]
      },
      "AnalyzerAnalyzeRequest": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "description": "Target URL (must start with http:// or https://)."
          },
          "html": {
            "type": "string",
            "nullable": true,
            "description": "Raw HTML source of the page."
          },
          "scripts": {
            "type": "array",
            "description": "Captured script tags and inline JavaScript.",
            "items": {
              "type": "object",
              "properties": {
                "src": { "type": "string", "nullable": true },
                "code": { "type": "string", "nullable": true }
              },
              "additionalProperties": true
            },
            "default": []
          },
          "forms": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "action": { "type": "string", "nullable": true },
                "method": { "type": "string", "nullable": true },
                "inputs": {
                  "type": "array",
                  "items": {
                    "oneOf": [
                      { "type": "string" },
                      {
                        "type": "object",
                        "properties": {
                          "name": { "type": "string", "nullable": true },
                          "tag": { "type": "string", "nullable": true },
                          "type": { "type": "string", "nullable": true },
                          "value": { "type": "string", "nullable": true },
                          "placeholder": { "type": "string", "nullable": true }
                        },
                        "additionalProperties": true
                      }
                    ]
                  },
                  "default": []
                }
              },
              "additionalProperties": true
            },
            "default": []
          },
          "iframes": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "src": { "type": "string", "nullable": true },
                "title": { "type": "string", "nullable": true }
              },
              "additionalProperties": true
            },
            "default": []
          },
          "includeSnippets": {
            "type": "boolean",
            "default": false,
            "description": "If true, include code snippets in results."
          }
        },
        "required": ["url"]
      },
      "AnalyzerFindingContext": {
        "type": "object",
        "description": "Context in which the vulnerability was detected (e.g. script index, form action).",
        "properties": {
          "type": { "type": "string" },
          "index": { "type": "integer" },
          "origin": { "type": "string" },
          "src": { "type": "string" },
          "formAction": { "type": "string" },
          "formMethod": { "type": "string" }
        }
      },
      "AnalyzerHtmlField": {
        "type": "object",
        "properties": {
          "iri": { "type": "string" },
          "source": { "type": "string" }
        },
        "required": ["iri"]
      },
      "AnalyzerHtmlTagNode": {
        "type": "object",
        "properties": {
          "iri": { "type": "string" },
          "source": { "type": "string" },
          "fields": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/AnalyzerHtmlField" }
          },
          "children": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/AnalyzerHtmlTagNode" }
          }
        },
        "required": ["iri"]
      },
      "AnalyzerFindingDetail": {
        "type": "object",
        "description": "Detailed AnalyzerScan finding with optional HTML structure.",
        "properties": {
          "id": { "type": "string" },
          "resolver": { "type": "string" },
          "vulnerabilityType": { "type": "string" },
          "severity": { "type": "string" },
          "findingCategory": { "type": "string" },
          "owaspCategory": { "type": "string" },
          "ruleId": { "type": "string" },
          "description": { "type": "string" },
          "remediation": { "type": "string" },
          "codeSnippet": { "type": "string" },
          "context": { "$ref": "#/components/schemas/AnalyzerFindingContext" },
          "html": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/AnalyzerHtmlTagNode" }
          }
        },
        "required": ["id"]
      },
      "AnalyzerFindingListResponse": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "string",
              "description": "Finding ID (IRI as string)"
            }
          },
          "page": { "$ref": "#/components/schemas/PageMetadata" }
        },
        "required": ["items", "page"]
      },
      "TechstackAnalyzeRequest": {
        "type": "object",
        "properties": {
          "technologies": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": { "type": "string" },
                "version": { "type": "string", "nullable": true }
              },
              "required": ["name"],
              "additionalProperties": false
            }
          },
          "waf": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": { "type": "string" },
                "version": { "type": "string", "nullable": true }
              },
              "required": ["name"],
              "additionalProperties": false
            },
            "default": []
          },
          "secureHeaders": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "header": { "type": "string" },
                "description": { "type": "string", "nullable": true },
                "urls": {
                  "type": "array",
                  "items": { "type": "string" },
                  "default": []
                }
              },
              "required": ["header"],
              "additionalProperties": false
            },
            "default": []
          },
          "cookies": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": { "type": "string" },
                "domain": { "type": "string", "nullable": true },
                "value": { "type": "string", "nullable": true },
                "secure": { "type": "boolean", "default": false },
                "httpOnly": { "type": "boolean", "default": false },
                "sameSite": { "type": "string", "nullable": true },
                "expirationDate": { "type": "number", "nullable": true }
              },
              "required": ["name"],
              "additionalProperties": false
            },
            "default": []
          },
          "mainDomain": { "type": "string", "nullable": true },
          "raw": {
            "type": "object",
            "description": "Auxiliary raw data blob.",
            "additionalProperties": true
          },
          "storage": {
            "type": "object",
            "description": "Auxiliary storage blob (e.g. localStorage / sessionStorage snapshot).",
            "additionalProperties": true
          }
        },
        "required": ["technologies"],
        "additionalProperties": false
      },
      "TechstackCveSummary": {
        "type": "object",
        "properties": {
          "iri": { "type": "string" },
          "id": { "type": "string" },
          "severity": { "type": "string" },
          "score": { "type": "number" }
        },
        "required": ["iri"]
      },
      "TechstackSoftwareEvidence": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Evidence type: Technology or WAF"
          },
          "name": { "type": "string" },
          "version": { "type": "string" },
          "cpe": {
            "type": "array",
            "items": { "type": "string" }
          },
          "cve": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/TechstackCveSummary" }
          }
        }
      },
      "TechstackHeaderEvidence": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "urls": {
            "type": "array",
            "items": { "type": "string" }
          }
        }
      },
      "TechstackCookieEvidence": {
        "type": "object",
        "properties": {
          "iri": { "type": "string" },
          "name": { "type": "string" },
          "domain": { "type": "string" },
          "path": { "type": "string" },
          "secure": { "type": "boolean" },
          "httpOnly": { "type": "boolean" },
          "sameSite": { "type": "string" },
          "expiration": { "type": "number" }
        },
        "required": ["iri"]
      },
      "TechstackFindingDetail": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "resolver": { "type": "string" },
          "vulnerabilityType": { "type": "string" },
          "severity": { "type": "string" },
          "findingCategory": { "type": "string" },
          "owaspCategory": { "type": "string" },
          "ruleId": { "type": "string" },
          "description": { "type": "string" },
          "remediation": { "type": "string" },
          "evidenceType": { "type": "string" },
          "software": {
            "$ref": "#/components/schemas/TechstackSoftwareEvidence"
          },
          "header": {
            "$ref": "#/components/schemas/TechstackHeaderEvidence"
          },
          "cookies": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/TechstackCookieEvidence" }
          }
        },
        "required": ["id"]
      },
      "TechstackFindingListResponse": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": { "type": "string" }
          },
          "page": { "$ref": "#/components/schemas/PageMetadata" }
        },
        "required": ["items", "page"]
      },
      "SparqlQueryRequest": {
        "type": "object",
        "properties": {
          "sparql": {
            "type": "string",
            "description": "SPARQL SELECT or ASK query string."
          }
        },
        "required": ["sparql"],
        "additionalProperties": false
      },
      "SparqlQueryResponse": {
        "type": "object",
        "properties": {
          "data": {
            "type": "object",
            "description": "Raw SPARQL JSON result from GraphDB (SELECT or ASK).",
            "additionalProperties": true
          }
        },
        "required": ["data"]
      },
      "SparqlUpdateRequest": {
        "type": "object",
        "properties": {
          "sparqlUpdate": {
            "type": "string",
            "description": "SPARQL UPDATE statement."
          }
        },
        "required": ["sparqlUpdate"],
        "additionalProperties": false
      },
      "EnqueueResponse": {
        "type": "object",
        "properties": {
          "accepted": { "type": "boolean" },
          "jobId": { "type": "string" }
        },
        "required": ["accepted", "jobId"]
      }
    },
    "securitySchemes": {}
  }
}
