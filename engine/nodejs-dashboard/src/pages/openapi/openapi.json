{
  "openapi": "3.0.1",
  "info": {
    "title": "OntoWebPT - HTTP Requests API",
    "version": "1.0.0",
    "description": "API for ingesting, listing and retrieving HTTP request data."
  },
  "paths": {
    "/http-requests/ingest-http": {
      "post": {
        "tags": ["HTTP Requests"],
        "summary": "Ingest one or more HTTP requests",
        "description": "Enqueues an ingestion job. Accepts either a single object, an array, or an object containing `items`.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Job accepted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "500": {
            "description": "Enqueue failed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },

    "/http-requests/results/{jobId}": {
      "get": {
        "tags": ["HTTP Requests"],
        "summary": "Get status or result of a job",
        "description": "Returns job status and result data.",
        "parameters": [
          {
            "name": "jobId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Job status detail",
            "content": {
              "application/json": {
                "schema": { "type": "object" }
              }
            }
          },
          "404": {
            "description": "Job not found",
            "content": {
              "application/json": {
                "schema": { "type": "object" }
              }
            }
          },
          "500": {
            "description": "Internal error",
            "content": {
              "application/json": {
                "schema": { "type": "object" }
              }
            }
          }
        }
      }
    },

    "/http-requests/list": {
      "get": {
        "tags": ["HTTP Requests"],
        "summary": "List HTTP requests (paginated)",
        "description": "Returns HTTP requests with optional filtering and pagination.",
        "parameters": [
          { "name": "limit", "in": "query", "schema": { "type": "integer" }, "required": false },
          { "name": "offset", "in": "query", "schema": { "type": "integer" }, "required": false },
          { "name": "method", "in": "query", "schema": { "type": "string" }, "required": false },
          { "name": "scheme", "in": "query", "schema": { "type": "string" }, "required": false },
          { "name": "authority", "in": "query", "schema": { "type": "string" }, "required": false },
          { "name": "path", "in": "query", "schema": { "type": "string" }, "required": false },
          { "name": "headerName", "in": "query", "schema": { "type": "string" }, "required": false },
          { "name": "headerValue", "in": "query", "schema": { "type": "string" }, "required": false },
          { "name": "text", "in": "query", "schema": { "type": "string" }, "required": false }
        ],
        "responses": {
          "200": {
            "description": "HTTP requests list",
            "content": {
              "application/json": {
                "schema": { "type": "object" }
              }
            }
          },
          "502": {
            "description": "GraphDB query failed",
            "content": {
              "application/json": {
                "schema": { "type": "object" }
              }
            }
          }
        }
      }
    },

    "/http-requests/{id}": {
      "get": {
        "tags": ["HTTP Requests"],
        "summary": "Get single HTTP request by ID",
        "description": "Returns the details of a single HTTP request.",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Request details",
            "content": {
              "application/json": {
                "schema": { "type": "object" }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": { "type": "object" }
              }
            }
          },
          "502": {
            "description": "GraphDB query failed",
            "content": {
              "application/json": {
                "schema": { "type": "object" }
              }
            }
          }
        }
      }
    },

    "/http-requests/finding/list": {
      "get": {
        "tags": ["HTTP Requests"],
        "summary": "List HTTP findings",
        "description": "Return paginated findings detected by HttpResolver.",
        "parameters": [
          { "name": "limit", "in": "query", "schema": { "type": "integer" }, "required": false },
          { "name": "offset", "in": "query", "schema": { "type": "integer" }, "required": false }
        ],
        "responses": {
          "200": {
            "description": "Findings list",
            "content": { "application/json": { "schema": { "type": "object" } } }
          },
          "502": {
            "description": "GraphDB error",
            "content": { "application/json": { "schema": { "type": "object" } } }
          }
        }
      }
    },

    "/http-requests/finding/{id}": {
      "get": {
        "tags": ["HTTP Requests"],
        "summary": "Finding detail",
        "description": "Get detailed information about an HTTP finding.",
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Finding detail", "content": { "application/json": { "schema": { "type": "object" } } } },
          "404": { "description": "Not found", "content": { "application/json": { "schema": { "type": "object" } } } },
          "502": { "description": "GraphDB error", "content": { "application/json": { "schema": { "type": "object" } } } }
        }
      }
    },
    "/analyzer/analyze": {
    "post": {
      "tags": ["Analyzer"],
      "summary": "Analyze HTML, scripts, forms and iframes",
      "description": "Enqueues a static analysis job using HTML, scripts, forms and iframe data.",
      "requestBody": {
        "required": true,
        "content": {
          "application/json": {
            "schema": {
              "type": "object"
            }
          }
        }
      },
      "responses": {
        "202": {
          "description": "Job accepted",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "500": {
          "description": "Enqueue failed",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        }
      }
    }
  },

  "/analyzer/results/{jobId}": {
    "get": {
      "tags": ["Analyzer"],
      "summary": "Get status or result of analyzer job",
      "description": "Returns job execution status and result payload.",
      "parameters": [
        {
          "name": "jobId",
          "in": "path",
          "required": true,
          "schema": { "type": "string" }
        }
      ],
      "responses": {
        "200": {
          "description": "Job status detail",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "404": {
          "description": "Job not found",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "500": {
          "description": "Internal error",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        }
      }
    }
  },

  "/analyzer/finding/list": {
    "get": {
      "tags": ["Analyzer"],
      "summary": "List analyzer findings (paginated)",
      "description": "Returns analyzer findings with pagination, without detailed content.",
      "parameters": [
        {
          "name": "limit",
          "in": "query",
          "required": false,
          "schema": { "type": "integer" }
        },
        {
          "name": "offset",
          "in": "query",
          "required": false,
          "schema": { "type": "integer" }
        }
      ],
      "responses": {
        "200": {
          "description": "Findings list",
          "content": { "application/json": { "schema": { "type": "object" } } }
        },
        "502": {
          "description": "GraphDB query failed",
          "content": { "application/json": { "schema": { "type": "object" } } }
        }
      }
    }
  },
   "/analyzer/finding/{id}": {
    "get": {
      "tags": ["Analyzer"],
      "summary": "Get analyzer finding detail",
      "description": "Returns full details for a specific analyzer finding.",
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "required": true,
          "schema": { "type": "string" }
        }
      ],
      "responses": {
        "200": {
          "description": "Finding detail",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "404": {
          "description": "Finding not found",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "502": {
          "description": "GraphDB query failed",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        }
      }
    }
  },
  "/techstack/analyze": {
    "post": {
      "tags": ["Techstack"],
      "summary": "Analyze detected technologies, WAF, headers and cookies",
      "description": "Enqueues a job to analyze the technology stack based on headers, cookies, WAF hints and client-detected technologies.",
      "requestBody": {
        "required": true,
        "content": {
          "application/json": {
            "schema": {
              "type": "object"
            }
          }
        }
      },
      "responses": {
        "202": {
          "description": "Job accepted",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "500": {
          "description": "Enqueue failed",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        }
      }
    }
  },

  "/techstack/results/{jobId}": {
    "get": {
      "tags": ["Techstack"],
      "summary": "Get status or result of a techstack analysis job",
      "description": "Returns job execution status and analyzed technology stack details.",
      "parameters": [
        {
          "name": "jobId",
          "in": "path",
          "required": true,
          "schema": { "type": "string" }
        }
      ],
      "responses": {
        "200": {
          "description": "Job status detail",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "404": {
          "description": "Job not found",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "500": {
          "description": "Internal error",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        }
      }
    }
  },

  "/techstack/finding/list": {
    "get": {
      "tags": ["Techstack"],
      "summary": "List techstack findings (paginated)",
      "description": "Returns findings detected by the Techstack resolver, without detailed evidence.",
      "parameters": [
        {
          "name": "limit",
          "in": "query",
          "required": false,
          "schema": { "type": "integer" }
        },
        {
          "name": "offset",
          "in": "query",
          "required": false,
          "schema": { "type": "integer" }
        }
      ],
      "responses": {
        "200": {
          "description": "Findings list",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "502": {
          "description": "GraphDB query failed",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        }
      }
    }
  },"/techstack/finding/{id}": {
    "get": {
      "tags": ["Techstack"],
      "summary": "Get techstack finding details",
      "description": "Returns complete detail for a single Techstack finding, including software evidence, header evidence and cookie evidence.",
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "required": true,
          "schema": { "type": "string" }
        }
      ],
      "responses": {
        "200": {
          "description": "Finding detail",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "404": {
          "description": "Finding not found",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "502": {
          "description": "GraphDB query failed",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        }
      }
    }
  },
  "/sparql/query": {
    "post": {
      "tags": ["SPARQL"],
      "summary": "Execute a SPARQL SELECT/ASK query",
      "description": "Validates and executes a SPARQL SELECT or ASK query synchronously. UPDATE is not allowed in this endpoint.",
      "requestBody": {
        "required": true,
        "content": {
          "application/json": {
            "schema": {
              "type": "object"
            }
          }
        }
      },
      "responses": {
        "200": {
          "description": "SPARQL query executed successfully",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "502": {
          "description": "GraphDB query failed",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        }
      }
    }
  },
  "/sparql/update": {
    "post": {
      "tags": ["SPARQL"],
      "summary": "Enqueue a SPARQL UPDATE job",
      "description": "Accepts a SPARQL UPDATE query and enqueues it for asynchronous execution.",
      "requestBody": {
        "required": true,
        "content": {
          "application/json": {
            "schema": {
              "type": "object"
            }
          }
        }
      },
      "responses": {
        "202": {
          "description": "Update job accepted",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "500": {
          "description": "Failed to enqueue SPARQL update job",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        }
      }
    }
  },"/health": {
    "get": {
      "tags": ["Health"],
      "summary": "Health status of the API server and dependencies",
      "description": "Returns overall readiness/health of the API, including server, GraphDB and Redis status.",
      "parameters": [],
      "responses": {
        "200": {
          "description": "Service is healthy and all dependencies are UP",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        },
        "503": {
          "description": "One or more dependencies are DOWN (server, Redis, GraphDB)",
          "content": {
            "application/json": {
              "schema": { "type": "object" }
            }
          }
        }
      }
    }
  }
    
  },
  "components": {
    "schemas": {},
    "securitySchemes": {}
  }
}
